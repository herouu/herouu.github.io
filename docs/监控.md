## grafana+prometheus监控

### prometheus

```shell
 docker run -d \
--name prometheus \
--restart=always \
--privileged=true  \
-p 9090:9090 \
-e TZ=Asia/Shanghai \
-v /etc/localtime:/etc/localtime \
-v /volume1/docker/prometheus/prometheus.yml:/etc/prometheus/prometheus.yml \
prom/prometheus 
```

```yml
# prometheus.yml
global:
  scrape_interval: 60s
  evaluation_interval: 60s

scrape_configs:
  - job_name: prometheus
    static_configs:
      - targets: ['172.17.0.1:9090']
        labels:
          instance: prometheus
  - job_name: linux
    static_configs:
      - targets: ['172.17.0.1:9100']
        labels:
          instance: cAdvisor
  - job_name: cadvisor
    static_configs:
      - targets: ['172.17.0.1:18080']
        labels:
          instance: cAdvisor
  - job_name: mysqld
    static_configs:
      - targets: ['172.17.0.1:9104']
        labels:
          instance: mysql-exporter
  - job_name: redis
    static_configs:
      - targets: ['172.17.0.1:9121']
        labels:
          instance: redis-exporter  

```

### grafana

```shell
docker run -d \
  -p 13000:3000 \
  --name=grafana \
  -e TZ=Asia/Shanghai \
  -v /etc/localtime:/etc/localtime \
  --restart=always \
  --privileged=true  \
 grafana/grafana
```

### cadvisor

```shell
docker run -v /:/rootfs:ro -v /var/run:/var/run:rw -v /sys:/sys:ro -v /volume1/docker/cadvisor/var/lib/docker/:/var/lib/docker:ro -v /volume1/docker/cadvisor/dev/disk/:/dev/disk:ro -p 18080:8080 -d --name=cadvisor --restart=always google/cadvisor:latest

# docker container & OS node(node_exporter, cadvisor)
# dashboard id: 16314

```

### mysql-exporter

```shell
docker run -d --name mysqld_exporter --restart=always -p 9104:9104 -v /volume1/docker/mysqld-exporter/.my.cnf:/cfg/.my.cnf prom/mysqld-exporter --config.my-cnf=/cfg/.my.cnf

# Mysqld Exporter Dashboard CN 20221102-StarsL.cn
# dashboard id: 17320
```

```text
# .my.cnf
[client]
host=172.17.0.1
port=3306
user = root
password = 123456
```

### node-exporter

```shell
docker run -d --name node-exporter --restart=always -p 9100:9100 -v "/proc:/host/proc:ro" -v "/sys:/host/sys:ro" -v "/:/rootfs:ro" prom/node-exporter


# Node Exporter Dashboard 220417 通用Job分组版
# dashboard id: 16098
```

### redis_exporter

```shell
docker run -d --name redis_exporter --restart=always -e REDIS_ADDR=172.17.0.1:6379 -p 9121:9121 oliver006/redis_exporter

# Redis Exporter Dashboard CN 20221128-StarsL.cn 
# dashboard id: 17507

```
